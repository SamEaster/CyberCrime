<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CyberCrime Risk Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg-dark: #0f1117;
            --bg-card: #1a1d2e;
            --bg-input: #252840;
            --accent: #6c63ff;
            --accent-hover: #5a52e0;
            --green: #00e676;
            --yellow: #ffca28;
            --red: #ff5252;
            --text: #e0e0e0;
            --text-dim: #9e9e9e;
            --border: #2d3154;
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            min-height: 100vh;
        }

        /* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .navbar {
            display: flex; align-items: center; justify-content: space-between;
            padding: 16px 32px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 100;
        }
        .navbar h1 { font-size: 1.4rem; color: var(--accent); }
        .navbar .nav-links { display: flex; gap: 8px; }
        .navbar .nav-links button {
            background: transparent; border: 1px solid var(--border);
            color: var(--text); padding: 8px 18px; border-radius: 8px;
            cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
        }
        .navbar .nav-links button:hover,
        .navbar .nav-links button.active {
            background: var(--accent); border-color: var(--accent); color: #fff;
        }

        /* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

        .page { display: none; }
        .page.active { display: block; }

        /* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 24px; margin-bottom: 20px;
        }
        .card h2 { font-size: 1.1rem; margin-bottom: 16px; color: var(--accent); }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px; margin-bottom: 24px;
        }
        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 20px; text-align: center;
        }
        .stat-card .value {
            font-size: 2rem; font-weight: 700; color: var(--accent);
        }
        .stat-card .label {
            font-size: 0.85rem; color: var(--text-dim); margin-top: 4px;
        }

        /* â”€â”€ Charts Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
        }
        .chart-box {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 20px;
        }
        .chart-box h3 {
            font-size: 1rem; margin-bottom: 12px; color: var(--text-dim);
        }
        .chart-box canvas { width: 100% !important; max-height: 320px; }

        /* â”€â”€ Input Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .input-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .input-tabs button {
            background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text-dim); padding: 10px 20px; border-radius: 8px;
            cursor: pointer; font-size: 0.9rem; transition: all 0.2s;
        }
        .input-tabs button:hover,
        .input-tabs button.active {
            background: var(--accent); color: #fff; border-color: var(--accent);
        }

        .input-panel { display: none; }
        .input-panel.active { display: block; }

        /* â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group label {
            font-size: 0.85rem; color: var(--text-dim); font-weight: 500;
        }
        .form-group input, .form-group select, .form-group textarea {
            background: var(--bg-input); border: 1px solid var(--border);
            color: var(--text); padding: 10px 14px; border-radius: 8px;
            font-size: 0.95rem; outline: none; transition: border 0.2s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--accent);
        }
        .form-group textarea { resize: vertical; min-height: 120px; }

        .file-drop {
            border: 2px dashed var(--border); border-radius: var(--radius);
            padding: 40px; text-align: center; cursor: pointer;
            transition: border-color 0.2s; color: var(--text-dim);
        }
        .file-drop:hover { border-color: var(--accent); }
        .file-drop input { display: none; }
        .file-drop .icon { font-size: 2.5rem; margin-bottom: 8px; }

        .btn {
            background: var(--accent); color: #fff; border: none;
            padding: 12px 32px; border-radius: 8px; font-size: 1rem;
            cursor: pointer; transition: background 0.2s; margin-top: 16px;
            font-weight: 600;
        }
        .btn:hover { background: var(--accent-hover); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* â”€â”€ Result Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .result-panel {
            display: none; margin-top: 24px;
            border: 1px solid var(--border); border-radius: var(--radius);
            overflow: hidden;
        }
        .result-panel.show { display: block; }

        .result-header {
            padding: 20px 24px; display: flex;
            align-items: center; justify-content: space-between;
        }
        .result-header.low { background: rgba(0,230,118,0.1); border-bottom: 2px solid var(--green); }
        .result-header.medium { background: rgba(255,202,40,0.1); border-bottom: 2px solid var(--yellow); }
        .result-header.high { background: rgba(255,82,82,0.1); border-bottom: 2px solid var(--red); }

        .risk-badge {
            font-size: 0.9rem; font-weight: 700; padding: 6px 16px;
            border-radius: 20px; text-transform: uppercase;
        }
        .risk-badge.low { background: var(--green); color: #000; }
        .risk-badge.medium { background: var(--yellow); color: #000; }
        .risk-badge.high { background: var(--red); color: #fff; }

        .score-display { font-size: 2.8rem; font-weight: 800; }
        .score-display.low { color: var(--green); }
        .score-display.medium { color: var(--yellow); }
        .score-display.high { color: var(--red); }

        .result-body { padding: 20px 24px; background: var(--bg-card); }
        .result-fields {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        .field-item {
            background: var(--bg-input); padding: 12px; border-radius: 8px;
        }
        .field-item .f-label { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }
        .field-item .f-value { font-size: 1.1rem; font-weight: 600; margin-top: 4px; }

        /* â”€â”€ Risk Meter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .risk-meter-container { display: flex; flex-direction: column; align-items: center; gap: 12px; }
        .risk-meter {
            width: 200px; height: 110px; position: relative; overflow: hidden;
        }
        .risk-meter svg { width: 100%; height: 100%; }

        /* â”€â”€ Loader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loader {
            display: none; justify-content: center; align-items: center;
            padding: 40px; gap: 8px;
        }
        .loader.show { display: flex; }
        .loader .dot {
            width: 12px; height: 12px; background: var(--accent);
            border-radius: 50%; animation: bounce 1.4s infinite both;
        }
        .loader .dot:nth-child(2) { animation-delay: 0.2s; }
        .loader .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            .navbar { padding: 12px 16px; flex-direction: column; gap: 12px; }
            .container { padding: 16px; }
            .charts-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <h1>ğŸ›¡ï¸ CyberCrime Risk Dashboard</h1>
    <div class="nav-links">
        <button class="active" onclick="showPage('dashboard')">Dashboard</button>
        <button onclick="showPage('assess')">Risk Assessment</button>
    </div>
</nav>

<div class="container">

    <!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD PAGE â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-dashboard" class="page active">
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card"><div class="value" id="statCases">â€”</div><div class="label">Total Cases</div></div>
            <div class="stat-card"><div class="value" id="statLoss">â€”</div><div class="label">Total Loss (â‚¹)</div></div>
            <div class="stat-card"><div class="value" id="statAvgLoss">â€”</div><div class="label">Avg Loss (â‚¹)</div></div>
            <div class="stat-card"><div class="value" id="statAvgRisk">â€”</div><div class="label">Avg Risk Score</div></div>
        </div>

        <div class="charts-grid">
            <div class="chart-box">
                <h3>ğŸ“… Cases & Loss by Year</h3>
                <canvas id="chartYearTrend"></canvas>
            </div>
            <div class="chart-box">
                <h3>ğŸ”¥ Incident Type Distribution</h3>
                <canvas id="chartIncidents"></canvas>
            </div>
            <div class="chart-box">
                <h3>ğŸ¢ Category Distribution</h3>
                <canvas id="chartCategories"></canvas>
            </div>
            <div class="chart-box">
                <h3>âš ï¸ Risk Classification</h3>
                <canvas id="chartRiskClass"></canvas>
            </div>
            <div class="chart-box">
                <h3>ğŸ™ï¸ Top Cities</h3>
                <canvas id="chartCities"></canvas>
            </div>
            <div class="chart-box">
                <h3>ğŸ“Š Risk Score Distribution</h3>
                <canvas id="chartRiskDist"></canvas>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• ASSESSMENT PAGE â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="page-assess" class="page">
        <div class="card">
            <h2>ğŸ” Assess Cyber Crime Risk</h2>
            <p style="color:var(--text-dim); margin-bottom:16px;">
                Submit a complaint via text, image, audio, video, or structured form to get a risk assessment.
            </p>

            <div class="input-tabs">
                <button class="active" onclick="showInputTab('form')">ğŸ“ Form</button>
                <button onclick="showInputTab('text')">ğŸ’¬ Text</button>
                <button onclick="showInputTab('image')">ğŸ–¼ï¸ Image</button>
                <button onclick="showInputTab('audio')">ğŸ¤ Audio</button>
                <button onclick="showInputTab('video')">ğŸ¥ Video</button>
            </div>

            <!-- FORM Input -->
            <div id="input-form" class="input-panel active">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Year</label>
                        <input type="number" id="fYear" value="2025" min="2000" max="2030" />
                    </div>
                    <div class="form-group">
                        <label>Amount Lost (â‚¹)</label>
                        <input type="number" id="fAmount" placeholder="e.g. 50000" />
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="fCity" placeholder="e.g. Mumbai" />
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="fCategory">
                            <option value="Personal">Personal</option>
                            <option value="Financial">Financial</option>
                            <option value="Corporate">Corporate</option>
                            <option value="Government">Government</option>
                            <option value="E-commerce">E-commerce</option>
                            <option value="Health">Health</option>
                            <option value="Educational">Educational</option>
                            <option value="Social Media">Social Media</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Incident Type</label>
                        <select id="fIncident">
                            <option value="Phishing">Phishing</option>
                            <option value="Online Fraud">Online Fraud</option>
                            <option value="Hacking">Hacking</option>
                            <option value="Ransomware">Ransomware</option>
                            <option value="Data Breach">Data Breach</option>
                            <option value="Malware">Malware</option>
                            <option value="Identity Theft">Identity Theft</option>
                            <option value="Cyber Bullying">Cyber Bullying</option>
                            <option value="Others">Others</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="submitForm()">Analyze Risk</button>
            </div>

            <!-- TEXT Input -->
            <div id="input-text" class="input-panel">
                <div class="form-group">
                    <label>Complaint Text</label>
                    <textarea id="fText" placeholder="Describe the cyber crime incident in detail..."></textarea>
                </div>
                <button class="btn" onclick="submitText()">Analyze Risk</button>
            </div>

            <!-- IMAGE Input -->
            <div id="input-image" class="input-panel">
                <div class="file-drop" onclick="document.getElementById('fImage').click()" id="dropImage">
                    <div class="icon">ğŸ–¼ï¸</div>
                    <p>Click or drag & drop an image</p>
                    <p style="font-size:0.8rem; margin-top:4px;">PNG, JPG, JPEG supported</p>
                    <input type="file" id="fImage" accept="image/*" onchange="handleFile(this, 'dropImage')" />
                </div>
                <button class="btn" onclick="submitFile('image')">Analyze Risk</button>
            </div>

            <!-- AUDIO Input -->
            <div id="input-audio" class="input-panel">
                <div class="file-drop" onclick="document.getElementById('fAudio').click()" id="dropAudio">
                    <div class="icon">ğŸ¤</div>
                    <p>Click or drag & drop an audio file</p>
                    <p style="font-size:0.8rem; margin-top:4px;">MP3, WAV, OGG supported</p>
                    <input type="file" id="fAudio" accept="audio/*" onchange="handleFile(this, 'dropAudio')" />
                </div>
                <button class="btn" onclick="submitFile('audio')">Analyze Risk</button>
            </div>

            <!-- VIDEO Input -->
            <div id="input-video" class="input-panel">
                <div class="file-drop" onclick="document.getElementById('fVideo').click()" id="dropVideo">
                    <div class="icon">ğŸ¥</div>
                    <p>Click or drag & drop a video file</p>
                    <p style="font-size:0.8rem; margin-top:4px;">MP4, AVI, MOV supported</p>
                    <input type="file" id="fVideo" accept="video/*" onchange="handleFile(this, 'dropVideo')" />
                </div>
                <button class="btn" onclick="submitFile('video')">Analyze Risk</button>
            </div>
        </div>

        <!-- Loader -->
        <div class="loader" id="loader">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>

        <!-- Result -->
        <div class="result-panel" id="resultPanel">
            <div class="result-header" id="resultHeader">
                <div>
                    <div style="font-size:0.85rem;color:var(--text-dim);margin-bottom:4px;">RISK SCORE</div>
                    <div class="score-display" id="resultScore">â€”</div>
                </div>
                <div>
                    <span class="risk-badge" id="resultBadge">â€”</span>
                </div>
            </div>
            <div class="result-body">
                <h3 style="margin-bottom:12px; font-size:0.95rem; color:var(--text-dim);">Extracted Information</h3>
                <div class="result-fields" id="resultFields"></div>
            </div>
        </div>
    </div>
</div>

<script>
const API = '';  // same origin

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');

    if (page === 'dashboard') loadDashboard();
}

function showInputTab(tab) {
    document.querySelectorAll('.input-panel').forEach(p => p.classList.remove('active'));
    document.getElementById('input-' + tab).classList.add('active');
    document.querySelectorAll('.input-tabs button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
}

function handleFile(input, dropId) {
    const file = input.files[0];
    if (file) {
        document.getElementById(dropId).querySelector('p').textContent = 'âœ… ' + file.name;
    }
}

// â”€â”€ Form Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function submitForm() {
    const data = {
        year: parseInt(document.getElementById('fYear').value),
        amount_lost_inr: parseFloat(document.getElementById('fAmount').value) || 0,
        city: document.getElementById('fCity').value || 'Unknown',
        category: document.getElementById('fCategory').value,
        incident_type: document.getElementById('fIncident').value,
    };
    await sendRequest('/api/assess/form', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
}

async function submitText() {
    const text = document.getElementById('fText').value;
    if (!text.trim()) return alert('Please enter complaint text.');
    const fd = new FormData();
    fd.append('text', text);
    await sendRequest('/api/assess/text', { method: 'POST', body: fd });
}

async function submitFile(type) {
    const inputId = type === 'image' ? 'fImage' : type === 'audio' ? 'fAudio' : 'fVideo';
    const file = document.getElementById(inputId).files[0];
    if (!file) return alert('Please select a file.');
    const fd = new FormData();
    fd.append('file', file);
    await sendRequest('/api/assess/' + type, { method: 'POST', body: fd });
}

async function sendRequest(url, options) {
    const loader = document.getElementById('loader');
    const panel = document.getElementById('resultPanel');
    loader.classList.add('show');
    panel.classList.remove('show');

    try {
        const res = await fetch(API + url, options);
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || 'Server error');
        showResult(data);
    } catch (e) {
        alert('Error: ' + e.message);
    } finally {
        loader.classList.remove('show');
    }
}

function showResult(data) {
    const panel = document.getElementById('resultPanel');
    const header = document.getElementById('resultHeader');
    const score = document.getElementById('resultScore');
    const badge = document.getElementById('resultBadge');
    const fields = document.getElementById('resultFields');

    const cls = data.classification.toLowerCase();
    header.className = 'result-header ' + cls;
    score.className = 'score-display ' + cls;
    score.textContent = data.risk_score.toFixed(2);
    badge.className = 'risk-badge ' + cls;
    badge.textContent = data.classification;

    const ef = data.extracted_fields;
    fields.innerHTML = [
        { label: 'Year', value: ef.year },
        { label: 'Amount Lost', value: 'â‚¹' + (ef.amount_lost_inr || 0).toLocaleString('en-IN') },
        { label: 'City', value: ef.city },
        { label: 'Category', value: ef.category },
        { label: 'Incident Type', value: ef.incident_type },
    ].map(f => `<div class="field-item"><div class="f-label">${f.label}</div><div class="f-value">${f.value}</div></div>`).join('');

    panel.classList.add('show');
}

// â”€â”€ Dashboard Charts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const chartInstances = {};

function destroyChart(id) {
    if (chartInstances[id]) { chartInstances[id].destroy(); delete chartInstances[id]; }
}

const CHART_COLORS = ['#6c63ff','#ff5252','#00e676','#ffca28','#29b6f6','#ab47bc','#ff7043','#26a69a','#ec407a'];

Chart.defaults.color = '#9e9e9e';
Chart.defaults.borderColor = '#2d3154';

async function loadDashboard() {
    try {
        const [ovRes, rdRes] = await Promise.all([
            fetch(API + '/api/analytics/overview'),
            fetch(API + '/api/analytics/risk-distribution'),
        ]);
        const overview = await ovRes.json();
        const riskDist = await rdRes.json();

        // Stats
        document.getElementById('statCases').textContent = overview.total_cases.toLocaleString();
        document.getElementById('statLoss').textContent = 'â‚¹' + (overview.total_loss / 1e7).toFixed(2) + ' Cr';
        document.getElementById('statAvgLoss').textContent = 'â‚¹' + overview.avg_loss.toLocaleString('en-IN');
        document.getElementById('statAvgRisk').textContent = overview.avg_risk_score;

        // Year Trend
        destroyChart('chartYearTrend');
        const yt = overview.year_trend.sort((a,b) => a.Year - b.Year);
        chartInstances['chartYearTrend'] = new Chart(document.getElementById('chartYearTrend'), {
            type: 'bar',
            data: {
                labels: yt.map(r => r.Year),
                datasets: [
                    { label: 'Cases', data: yt.map(r => r.cases), backgroundColor: '#6c63ff', borderRadius: 4, yAxisID: 'y' },
                    { label: 'Total Loss (â‚¹L)', data: yt.map(r => r.total_loss/1e5), type:'line', borderColor:'#ff5252', pointBackgroundColor:'#ff5252', tension:0.3, yAxisID:'y1' },
                ]
            },
            options: { responsive:true, scales: { y:{position:'left'}, y1:{position:'right', grid:{drawOnChartArea:false}} } }
        });

        // Incident Types
        destroyChart('chartIncidents');
        const inc = overview.incident_type_distribution;
        chartInstances['chartIncidents'] = new Chart(document.getElementById('chartIncidents'), {
            type: 'doughnut',
            data: { labels: Object.keys(inc), datasets: [{ data: Object.values(inc), backgroundColor: CHART_COLORS }] },
            options: { responsive:true, plugins:{legend:{position:'right'}} }
        });

        // Categories
        destroyChart('chartCategories');
        const cat = overview.category_distribution;
        chartInstances['chartCategories'] = new Chart(document.getElementById('chartCategories'), {
            type: 'polarArea',
            data: { labels: Object.keys(cat), datasets: [{ data: Object.values(cat), backgroundColor: CHART_COLORS.map(c=>c+'99') }] },
            options: { responsive:true, plugins:{legend:{position:'right'}} }
        });

        // Risk Classification
        destroyChart('chartRiskClass');
        const cd = overview.classification_distribution;
        chartInstances['chartRiskClass'] = new Chart(document.getElementById('chartRiskClass'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(cd),
                datasets: [{ data: Object.values(cd), backgroundColor: ['#00e676','#ffca28','#ff5252'] }]
            },
            options: { responsive:true, plugins:{legend:{position:'right'}} }
        });

        // Cities
        destroyChart('chartCities');
        const cities = overview.city_distribution;
        chartInstances['chartCities'] = new Chart(document.getElementById('chartCities'), {
            type: 'bar',
            data: { labels: Object.keys(cities), datasets: [{ label:'Cases', data:Object.values(cities), backgroundColor:'#29b6f6', borderRadius:4 }] },
            options: { responsive:true, indexAxis:'y' }
        });

        // Risk Distribution
        destroyChart('chartRiskDist');
        const rd = riskDist.distribution;
        chartInstances['chartRiskDist'] = new Chart(document.getElementById('chartRiskDist'), {
            type: 'bar',
            data: { labels: Object.keys(rd), datasets: [{ label:'Count', data:Object.values(rd), backgroundColor:['#00e676','#66bb6a','#ffca28','#ff7043','#ff5252'], borderRadius:4 }] },
            options: { responsive:true }
        });

    } catch (e) {
        console.error('Dashboard load error:', e);
    }
}

// Load dashboard on page load
loadDashboard();
</script>

</body>
</html>
